# 腾讯云ASR说话人分离功能

## 🎯 功能概述

为中文版音频总结服务启用了腾讯云ASR的说话人分离功能，可以自动识别和区分音频中的不同说话人。

## 🔧 技术实现

### 1. ASR参数配置

```typescript
const params = {
  EngineModelType: '16k_zh', // 使用基础中文模型（支持说话人分离）
  ChannelNum: 1, // 单声道（说话人分离要求）
  ResTextFormat: 0, // 基础文本格式
  SourceType: 0, // 音频URL
  Url: finalAudioUrl, // 音频文件URL
  SpeakerDiarization: 1, // 开启说话人分离
  SpeakerNumber: 0, // 自动分离（最多分离出20个人）
}
```

### 2. 参数说明

#### **SpeakerDiarization**
- **值**: `1` (开启)
- **说明**: 启用说话人分离功能
- **支持引擎**: `8k_zh/16k_zh/16k_ms/16k_en/16k_id/16k_zh_large/16k_zh_dialect`
- **要求**: `ChannelNum=1` (单声道)

#### **SpeakerNumber**
- **值**: `0` (自动分离)
- **说明**: 自动检测说话人数量，最多分离出20个人
- **可选值**: 
  - `0`: 自动分离（推荐）
  - `1-10`: 指定人数分离

## 📊 结果格式

### 原始返回格式
腾讯云可能返回包含说话人标识的格式：
```
[0:1.000,0:12.580]spk0 哈喽，大家好，今天给大家讲CSS的安装
[0:13.140,0:18.860]spk1 好的，我们来看一下具体的操作步骤
[0:19.000,0:25.500]spk0 首先呢，我们打开cos的官网
```

### 解析后的格式
```typescript
{
  startTime: 1.0,
  endTime: 12.58,
  text: "哈喽，大家好，今天给大家讲CSS的安装",
  speaker: "Speaker 1",
  speakerId: 1
}
```

## 🎨 前端显示

### 时间戳内容格式
```
[00:01-00:12] Speaker 1 哈喽，大家好，今天给大家讲CSS的安装
[00:13-00:18] Speaker 2 好的，我们来看一下具体的操作步骤
[00:19-00:25] Speaker 1 首先呢，我们打开cos的官网
```

### 视觉设计
- **时间戳**: 橙色标签 (`bg-coral-100`)
- **说话人**: 蓝色标签 (`bg-blue-100`)
- **文本内容**: 深灰色文字 (`text-charcoal-700`)

## 🔍 解析逻辑

### 1. 带说话人标识的格式
```typescript
const speakerMatch = line.match(/\[(\d+):(\d+\.\d+),(\d+):(\d+\.\d+)\](?:spk(\d+))?\s*(.*)/)
```

### 2. 普通时间戳格式
```typescript
const timestampMatch = line.match(/\[(\d+):(\d+\.\d+),(\d+):(\d+\.\d+)\]\s*(.*)/)
```

### 3. 说话人编号转换
- `spk0` → `Speaker 1`
- `spk1` → `Speaker 2`
- `spk2` → `Speaker 3`
- ...

## 🎯 使用场景

### 适用场景
- ✅ **会议录音**: 多人参与的会议讨论
- ✅ **访谈节目**: 主持人与嘉宾的对话
- ✅ **播客节目**: 多主播的播客内容
- ✅ **教学视频**: 老师与学生的互动
- ✅ **客服录音**: 客服与客户的通话

### 技术要求
- ✅ **音频格式**: 支持常见音频格式
- ✅ **声道要求**: 单声道音频
- ✅ **语言支持**: 中文普通话及方言
- ✅ **人数限制**: 最多自动识别20个说话人

## 📈 功能优势

### 1. 自动识别
- **无需预设**: 自动检测说话人数量
- **智能分离**: AI算法自动区分不同声音特征
- **准确标记**: 为每个说话人分配唯一标识

### 2. 结构化输出
- **时间精确**: 精确到毫秒级的时间戳
- **说话人明确**: 清晰标识每段话的说话人
- **内容完整**: 保留完整的语音转文字内容

### 3. 用户体验
- **视觉区分**: 不同颜色标签区分时间和说话人
- **易于理解**: 直观的Speaker 1、Speaker 2标识
- **便于分析**: 结构化数据便于后续分析

## 🧪 测试建议

### 测试音频要求
1. **多人对话**: 包含2-5个不同说话人
2. **清晰音质**: 音质清晰，噪音较少
3. **单声道**: 确保音频为单声道格式
4. **中文内容**: 中文普通话或支持的方言

### 预期效果
- 不同说话人的内容会被正确分离
- 每段话都有对应的说话人标识
- 时间戳准确标记每段话的时间范围

## 🔄 向后兼容

### 兼容性保证
- ✅ **单人音频**: 自动标记为Speaker 1
- ✅ **无说话人信息**: 降级为普通时间戳格式
- ✅ **现有功能**: 不影响复制、下载等现有功能

### 渐进增强
- 如果检测到多个说话人，显示说话人信息
- 如果只有一个说话人，隐藏说话人标签
- 保持与现有UI的一致性

🎉 **现在中文版音频总结支持说话人分离，可以更好地处理多人对话的音频内容！**
